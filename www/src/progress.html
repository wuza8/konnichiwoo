<!DOCTYPE HTML>

<HTML>
<head>
    <link rel="stylesheet" href="dark.css">
    <link rel="stylesheet" href="layout.css">
    <script type="text/javascript" src="session.js"></script>

    <script>
        template = null;
        

        function init(){
            
            document.querySelector("#top-usericon").onclick=function(){
                userlist = document.querySelector("#flux-userlist");

                if(userlist.style.display == "none"){
                    userlist.style.display = "block";
                }
                else{
                    userlist.style.display = "none";
                }
            }
        }
        
    </script>
</head>

<body onload="init()">
    <nav>
        <img class="logo" src="logo.svg"></img>
        <ul>
            <li onclick='window.location="learn.html"'>Learn</li>
            <li onclick='window.location="progress.html"'>My progress</li>
            <li>Settings</li>
        </ul>
        <div id="rightSideButtons">
            <a id="new-button" href="editor.html">+ New</a>
            <!-- <button class="butt b-primary">Start repetition</button> -->
            <div id="top-usericon"></div>
            <!-- <button class="butt b-secondary" onclick="logout()">Logout</button> -->
        </div>
    </nav>
    <div id="flux-userlist" style="display: none">
        <div id="flux-userlist-user">
            
        </div>
        <div class="flux-userlist-button">
            Profile
        </div>
        <div onclick="logout()" class="flux-userlist-button">
            Logout
        </div>
    </div>
    <script>
        let user = JSON.parse(localStorage.getItem("user"));
        document.querySelector("#flux-userlist-user").innerHTML = user.username;
    </script>
    <div id="content-b">
        <div class="selection-bar">My progress
            <div class="selection-bar-end" style="width: calc(100% - 140px);"></div>
        </div>
        <span style="color: #aaa">You've learned <span id="progress-count" style="color: #fff; font-weight: bold;"> 12</span> words :O</span>
        <br><br>

        <div id="progress-place">
            <div class="progress-one">
                <div class="art-image-place">
                    <img src="word.png" class="art-image" />
                </div>
                <div class="progress-text"> 貴方 - You </div>
                <div class="progress-rating"><img class="progress-img" src="ok.png"></div>
            </div>
            <div class="progress-one">
                <div class="art-image-place">
                    <img src="word.png" class="art-image" />
                </div>
                <div class="progress-text"> 貴方 - You </div>
                <div class="progress-rating"><img class="progress-img" src="ok.png"></div>
            </div>
            <div class="progress-one">
                <div class="art-image-place">
                    <img src="word.png" class="art-image" />
                </div>
                <div class="progress-text"> 貴方 - You </div>
                <div class="progress-rating"><img class="progress-img" src="ok.png"></div>
            </div>
            <div class="progress-one">
                <div class="art-image-place">
                    <img src="word.png" class="art-image" />
                </div>
                <div class="progress-text"> 貴方 - You </div>
                <div class="progress-rating"><img class="progress-img" src="ok.png"></div>
            </div>
            <div class="progress-one">
                <div class="art-image-place">
                    <img src="word.png" class="art-image" />
                </div>
                <div class="progress-text"> 貴方 - You </div>
                <div class="progress-rating"><img class="progress-img" src="ok.png"></div>
            </div>
            <div class="progress-one">
                <div class="art-image-place">
                    <img src="word.png" class="art-image" />
                </div>
                <div class="progress-text"> 貴方 - You </div>
                <div class="progress-rating"><img class="progress-img" src="meh.png"></div>
            </div>
        </div>
        <style>
            .progress-one{
                width: 24%;
                background-color: #4d4e4f;
                float: left;
                border-radius: 5px;
                margin: 5px;
            }
            .progress-text{
                line-height:85px;
                width: 60%;
                text-align: center;
                font-size: 20px;
                color: #abc1dd;
                font-weight: bold;
                float:left;
            }
            .progress-rating{
                width:10%;
                float:left;
                height: 85px;
            }
            .progress-img{
                padding: 20px;
                width: 50px;
                height: 50px;
            }
            .art-image-place{
                width: 20%;
            }
        </style>
        <script>
            let template='<div class="progress-one"> ' +
                '<div class="art-image-place">' +
                    '<img src="word.png" class="art-image" /> ' +
                '</div> ' +
                '<div class="progress-text"> {{word}} </div> ' +
                '<div class="progress-rating"><img class="progress-img" src="{{progress-img}}"></div> '+ 
            '</div>';

            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/api/gameplay/progress", true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader("Authorization", "Bearer "+ localStorage.getItem("token"));
            xhr.send();

            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;

                if (this.status == 200) {
                    var data = JSON.parse(this.responseText);
                    document.querySelector("#progress-count").innerHTML = data.length;
                    let progressPlace = document.querySelector("#progress-place");
                    progressPlace.innerHTML = "";

                    data.forEach(word => {
                        progressPlace.innerHTML += template
                            .replaceAll("{{word}}", word.wordForeign + " - "+ word.wordName)
                            .replaceAll("{{progress-img}}", (word.failedTimes > 0 ? "meh.png" : "ok.png"))

                    });
                    console.log(data);
                }
            };

        </script>
    </div>
</body>
</HTML>
