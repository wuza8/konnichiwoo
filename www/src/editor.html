<!DOCTYPE HTML>

<HTML>
<head>
    <link rel="stylesheet" href="dark.css">
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="editor.css">
    <style>
        #wordlist-left{
            float: left;
            width: 50%;   
        }

        #wordlist-left-place, #wordlist-right-place{
            height: 400px;
            overflow-y: scroll;
        }

        #wordlist-right{
            float: right;
            width: 49%;
            height: 200px;
            border-radius: 5px; 
            color: white;
        }
        .word-one{
            background: #808080;
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 5px; 
            color: black;
        }
        .word-one:hover{
            background: #909090;
            cursor:pointer;
        }
    </style>

    <script type="text/javascript" src="editortabs.js"></script>
    <script type="text/javascript" src="editor-logic.js"></script>
    <script type="text/javascript" src="editor-wordextractor.js"></script>
    <script type="text/javascript" src="editor-binds.js"></script>
    <script type="text/javascript" src="editor-save.js"></script>
    

    <script>
        function onload(){
            tabsinit();
            var area = document.querySelector('#texttab-text');
            var words = document.querySelector('#texttab-words');
            if (area.addEventListener) {
                area.addEventListener('input', function() {
                    words.value = extractWords(area.value);
                }, false);
            }

            
            bindInit();
            initSave();
        }

        function sendToWords(){
            text = document.querySelector("#texttab-words").value;
            words = extractWords(text)[0].split(",");
            foundWords = [];

            sentences.forEach(s => {
                words.forEach(w => {
                    if(s.goodForeignAnswers[0] == w || s.goodForeignAnswers[1] == w){
                        artCreator.addSentence(s.id);
                        foundWords.push(w);
                    }
                })
            });

            words.forEach(word => {
                let isFound = false;

                foundWords.forEach(fw => {
                    if(word == fw) isFound = true;
                });

                if(!isFound)
                    artCreator.addNewSentence(word);
            });

            recreateWordButtons();
            reloadInDB();
            reloadAlreadyInDbUsed();
        }

        function addSentence(id){
            console.log("id");
            console.log(id);
            artCreator.addSentence(id);
            reloadInDB();
            reloadAlreadyInDbUsed();
        }

        function removeSentence(id){
            artCreator.removeSentence(id);
            reloadInDB();
            reloadAlreadyInDbUsed();
        }
    </script>
</head>

<body onload="onload()">
    <nav>
        <img class="logo" src="logo.svg"></img>
        
        <input class="ebind-textname" type="text" id="artname">

        <ul>
            <li class="tabs tabs-button-text">Text</li>
            <li class="tabs tabs-button-words">Words</li>
            <li class="tabs tabs-button-added">Added</li>
            <li class="tabs tabs-button-metadata">Metadata</li>
            <li class="tabs tabs-button-save">Save</li>
        </ul>
        <div id="rightSideButtons">
            <a href="http://localhost:8081/api/login">
                <button class="butt b-primary">Help</button>
            </a>
            <button class="butt b-secondary" onclick='document.location.href="learn.html"'>Exit editing</button>
        </div>
    </nav>


    <div class="content tabs tabs-default tabs-content-text">
        
        <div id="texttab-left"  style="float:left;width:70%"><textarea placeholder="Write text to start" id="texttab-text" rows="40" cols="100"></textarea></div>
        
        <div id="texttab-right" style="float:left;width:25%">
            <textarea id="texttab-words" readonly></textarea>
            <button class="butt b-primary" style="float:right;width:100%; height: 50px;margin-top: 8px; display:block;" onclick="sendToWords()">Parse text to words</button>
        </div>
        
        
    </div>
    <div class="content tabs tabs-content-words">

        
        <div id="wordlist-left"><h2>To use</h2>
            <div id="wordlist-left-place"></div>
        </div>
        
        <script>
            let sentencesPlace = document.getElementById("wordlist-left-place");
            
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/art/sentences/all', true);
            xhr.onload = function() {
                if (xhr.status === 200) {
                    sentences = JSON.parse(xhr.responseText);

                    reloadInDB();
                    reloadAlreadyInDbUsed()

                    console.log();
                } else {
                    console.log('Error loading sentences.');
                }
            };
            xhr.send();

            function reloadInDB(){
                sentencesPlace.innerHTML = "";

                sentences.forEach(sentence => {
                    let isUsed = false;

                    artCreator.creation.artParts[0].sentences.forEach(i => {
                        if(sentence.id == i) isUsed = true;
                    })

                    if(!isUsed) {

                    sentencesPlace.innerHTML += 
                    '<div class="word-one" onclick=\'addSentence("'+ sentence.id +'")\'>' +
                        sentence.goodForeignAnswers[0] + " " +
                        sentence.goodForeignAnswers[1] + " " +
                        sentence.goodEnglishAnswers[0] + " " +
                        sentence.memoPictureURL +
                    '</div>';
                    }
                });
            }

        </script>

    <div id="wordlist-right" style="height: 400px">
        <h2>Used</h2>
            <div id="wordlist-right-place"></div>
    </div>

    <script>
        
        function reloadAlreadyInDbUsed() {
            let usedSentences = [];
            let usedSentencesPlace = document.getElementById("wordlist-right-place");
            console.log(artCreator.creation.artParts[0].sentences);
            artCreator.creation.artParts[0].sentences.forEach(i => {
                sentences.forEach(s => {
                    if(s.id == i) usedSentences.push(s);
                })
            })
            console.log(usedSentencesPlace);

            usedSentencesPlace.innerHTML = "";

            if(usedSentences.length == 0){
                usedSentencesPlace.innerHTML = "Nothing used.";
            }

            usedSentences.forEach(sentence => {
                
                usedSentencesPlace.innerHTML += 
                '<div class="word-one" onclick=\'removeSentence("'+ sentence.id +'")\'>' +
                    sentence.goodForeignAnswers[0] + " " +
                    sentence.goodForeignAnswers[1] + " " +
                    sentence.goodEnglishAnswers[0] + " " +
                    sentence.memoPictureURL +
                '</div>';
            });
        };
    </script>

    </div>
    <div class="content tabs tabs-content-added">
        <div class="added-wordlist">
            <span id="added-wordlist-place">
            </span>

            <button class="added-add-word-button" onclick="artCreator.addNewSentence();recreateWordButtons()">+ Add new word</button>
        </div>

        <div class="added-word-editor">
            <span id="added-word-editor-active">
                <input id="added-word-editor-input-foreign-kanji" type="text" placeholder="foreign kanji writing"> <a target="_blank" id="romajidesu-button"><button> Open romajidesu in new tab</button></a> </button> <br>
                <input id="added-word-editor-input-foreign-romaji" type="text" placeholder="foreign romaji writing"> <br>
                <input id="added-word-editor-input-english" type="text" placeholder="english translation">
                <input id="added-word-editor-input-memoimage" type="file" accept="image/jpeg, image/png, image/jpg">
                <img id="added-word-editor-image-display">
            </span>

            <span id="added-word-editor-nonactive">
                Select word from left to edit
            </span>
        </div>
    </div>
    <div class="content tabs tabs-content-metadata">
        <div class="metadata-main">
            <input id="metadata-originalauthor" type="text" placeholder="Original author name"> <br>
            <select id="metadata-arttype" placeholder="art type">
                <option value="">select arttype</option>
                <option value="music">Music</option>
            </select>
            <br>
            <input id="metadata-arturl" type="text" placeholder="Link to art"> <br>
        </div>


    </div>
    <div class="content tabs tabs-content-save">
        <div id="save-main">
            Save progress:
            <input id="save-new-save-name-input" type="text"><button id="save-new-save-submit" onclick="saveNew()"> Save </button><br>

            Saved progresses:
            <span id="save-saved-place"></span>
        </div>
        <br>
        <div id="save-main">
            <button class="butt b-primary" onclick="sendCreation()">Send to server</button>
        </div>
    </div>
</body>
</HTML>
