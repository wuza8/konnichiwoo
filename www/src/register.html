<!DOCTYPE HTML>

<HTML>
<head>
    <link rel="stylesheet" href="dark.css">
    <link rel="stylesheet" href="login.css">
    <link rel="stylesheet" href="layout.css">
    <script type="text/javascript" src="session.js"></script>
    <title> Register - Kwoo</title>
    

</head>

<body>
    <nav>
        <img class="logo" src="logo.svg"></img>
        <ul>

        </ul>
        <div id="rightSideButtons">
            
        </div>
    </nav>

    <div id="login-container">
        <img class="logo" style="margin-left: 140px; margin-top: 10px; margin-bottom:20px" src="biglogo.svg" height="100"><br>
        <div id="login-left">
            <form id="login-form" class="w-100">
                <input class="butt b-secondary" name="login" type="text" placeholder="login" class="w-100"> <br><br>
                <input class="butt b-secondary" name="email" type="text" placeholder="e-mail" class="w-100"> <br><br>
                <input class="butt b-secondary" name="password" type="password" placeholder="password"><br><br>
                <input class="butt b-secondary" name="password2" type="password" placeholder="again password"><br><br>
                <input class="butt b-primary w-100" type="submit" value="Register">
            </form>
        </div>
        <div id="login-right" style="padding-top: 90px">
            Welcome! <br><br>   
            Already have an account? <a href="login.html">Login</a>
        </div>
    </div>

    <script>
        let form = document.querySelector("#login-form");
        form.addEventListener("submit", (e) => {
            e.preventDefault();

            //Lock form while sending request
            form["login"].readOnly = true;
            form["email"].readOnly = true;
            form["password"].readOnly = true;
            form["password2"].readOnly = true;

            //Send request
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/auth/register", true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({
                login: form["login"].value,
                email: form["email"].value,
                password: form["password"].value
            }));

            xhr.onreadystatechange = function () {
                //When it's already sent, we turn off lock
                form["login"].readOnly = true;
                form["email"].readOnly = false;
                form["password"].readOnly = false;
                form["password2"].readOnly = false;

                if (this.readyState != 4) return;

                if (this.status == 200) {
                    document.location.href = "login.html";
                }
            };
 
        });
    </script>
</body>
</HTML>
